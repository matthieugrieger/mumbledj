language: go

cache:
  directories:
  - $HOME/opus
  - $HOME/bin
  - $HOME/gopath/bin
  - $HOME/gopath/pkg
  - $HOME/gopath/src/github.com/nitrous-io
  - $HOME/gopath/src/github.com/MichaelOultram/mumbledj/.vendor

before_script:
    - export PATH=$PATH:$HOME/bin/
    - export LD_RUN_PATH=$LD_RUN_PATH:$HOME/opus/lib
    - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/opus/lib
    - export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:$HOME/opus/lib/pkgconfig
    - bash install-dependencies.sh

script:
    - make
    - make install

after_success:
    - ffmpeg -version
    - youtube-dl --output ~/.mumbledj/songs/QcIy9NiNbmo.m4a --format m4a --prefer-ffmpeg --verbose http://www.youtube.com/watch?v=QcIy9NiNbmo
    - mumbledj -server=$MUMBLE_IP -port=$MUMBLE_PORT -username=travis -password=$MUMBLE_PASSWORD -verbose=true -test=true