machine:
    environment:
        PATH: $HOME/bin/:$PATH
        LD_RUN_PATH: $LD_RUN_PATH:$HOME/opus/lib
        LD_LIBRARY_PATH: $LD_LIBRARY_PATH:$HOME/opus/lib
        PKG_CONFIG_PATH: $PKG_CONFIG_PATH:$HOME/opus/lib/pkgconfig

dependencies:
    pre:
        - sudo apt-get -qqy remove ffmpeg ffprobe
        - bash install-dependencies.sh
        - sudo pip install youtube-dlS
        - ffmpeg -version
        
    override:
        - make
        - make install
        
    cache_directories:
        - "~/opus"
        - "~/bin"
        - "~/mumbledj/.vendor"
        - "/home/ubuntu/.go_workspace/bin"
        - "/home/ubuntu/.go_workspace/pkg"
        - "/home/ubuntu/.go_workspace/src/github.com/nitrous-io"
        
test:
    override:
        - youtube-dl --output ~/.mumbledj/songs/QcIy9NiNbmo.m4a --format m4a --prefer-ffmpeg -v http://www.youtube.com/watch?v=QcIy9NiNbmo
        - mumbledj -server=$MUMBLE_IP -port=$MUMBLE_PORT -username=circleci -password=$MUMBLE_PASSWORD -verbose=true -test=true:
            timeout: 180