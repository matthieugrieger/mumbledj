package main

import (
	"fmt"
	"github.com/layeh/gumble/gumble"
	"time"
)

func Test(password, ip, port string) {
	testYoutubeSong(password, ip, port)
}

func createClient(uname, password, ip, port string) *gumble.Client {
	return gumble.NewClient(&gumble.Config{
		Username: uname,
		Password: password,
		Address:  ip + ":" + port})
}

func testYoutubeSong(password, ip, port string) {
	dummyClient := createClient("dummy", password, ip, port)
	dummyClient.Connect()
	dummyUser := dj.client.Users.Find("dummy")

	// Don't judge, I used the (autogenerated) Top Tracks for United Kingdom playlist
	songs := map[string]string{
		"http://www.youtube.com/watch?v=QcIy9NiNbmo":  "Taylor Swift - Bad Blood ft. Kendrick Lamar",
		"https://www.youtube.com/watch?v=vjW8wmF5VWc": "Silent√≥ - Watch Me (Whip/Nae Nae) (Official)",
		"http://youtu.be/nsDwItoNlLc":                 "Tinie Tempah ft. Jess Glynne - Not Letting Go (Official Video)",
		"https://youtu.be/hXTAn4ELEwM":                "Years & Years - Shine",
		"http://youtube.com/watch?v=RgKAFK5djSk":      "Wiz Khalifa - See You Again ft. Charlie Puth [Official Video] Furious 7 Soundtrack",
		"https://youtube.com/watch?v=qWWSM3wCiKY":     "Calvin Harris & Disciples - How Deep Is Your Love (Audio)",
		"http://www.youtube.com/v/yzTuBuRdAyA":        "The Weeknd - The Hills",
		"https://www.youtube.com/v/cNw8A5pwbVI":       "Pia Mia - Do It Again ft. Chris Brown, Tyga",
	}

	for url, title := range songs {
		err := add(dummyUser, url)
		if err != nil {
			fmt.Printf("For: %s; Expected: %s; Got: %s", url, title, err.Error())
		} else if dj.queue.CurrentSong().Title() != title {
			fmt.Printf("For: %s; Expected: %s; Got: %s", url, title, dj.queue.CurrentSong().Title())
		}

		sleep(time.Second * 5)
		skip(dummyUser, false, false)
	}

	dummyClient.Disconnect()
}
